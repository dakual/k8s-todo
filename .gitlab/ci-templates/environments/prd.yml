variables:
  RUNNER: dev
  ENV: prd
  K8S_CLUSTER: ci-todo/app:minikube
  K8S_NAMESPACE: production
  DOMAIN: example.com


prd:build:backend:
  variables:
    APP: frontend
  extends: 
    - .prd-rules
    - .build


prd:build:frontend:
  variables:
    APP: backend
  extends: 
    - .prd-rules
    - .build


prd:deploy:
  extends: 
    - .prd-rules
    - .deploy
  environment:
    name: ${K8S_NAMESPACE}
    url: https://$CI_ENVIRONMENT_SLUG.${DOMAIN}
    on_stop: prd:destroy
    deployment_tier: production
  resource_group: ${K8S_NAMESPACE}
  needs:
    - prd:build:backend
    - prd:build:frontend
  when: manual


prd:release:
  extends: 
    - .prd-rules
    - .release
  needs:
    - prd:deploy
  when: manual


prd:destroy:
  extends: 
    - .prd-destroy-rules
    - .destroy
  environment:
    name: ${K8S_NAMESPACE}
    action: stop
  needs:
    - prd:deploy